<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Angular 2 and React</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="reveal.js/css/reveal.css">
        <!--<link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">-->
        <link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">

        <!--<link rel="stylesheet" href="reveal.js/css/theme/black.css" id="theme">-->
        <!--<link rel="stylesheet" href="reveal.js/css/theme/white.css" id="theme">-->
		<!--<link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">-->
        <!--<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">-->


		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">
		<style>
			/*pre code {*/
				/*display: block;*/
				/*padding: 0.5em;*/
				/*background: #FFFFFF !important;*/
				/*color: #000000 !important;*/
			/*}*/
			/*.right-img {*/
				/*margin-left: 10px !important;*/
				/*float: right;*/
				/*height: 500px;*/
			/*}*/
            .todo:before {
                content: 'TODO: ';
            }
            .todo {
                color: red !important;
            }
            code span.line-number {
                color: lightcoral;
            }
            .reveal pre code {
                max-height: 1000px !important;
            }

        </style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="reveal.js/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="reveal">

<!--Title: What Angular 2 programmers can learn from React-->

<!--Angular 2 and React are two main players in the modern world of JavaScript Web Frameworks. -->
<!--They inspired each other in many respects, but also have some fundamental differences.-->

<!--Categories of interest include-->
<!-- - change detection-->
<!-- - data flow patterns-->
<!-- - scope of framework-->
<!-- - server side rendering / universal apps-->
<!-- - 3rd party integration-->
<!-- - designated type system-->
<!-- - templating style-->

<!--By comparing to React this talk makes you understand Angular 2 better. -->
<!--It also brings Angular 2's design decisions into perspective and gives you a better feeling of -->
<!--the reasoning behind them.            -->

<!--Plan:-->
<!--0. Intro-->
<!-- - No flames-->
<!-- - Many things very similar-->
<!-- - Angular 2 closer to React than Angular 1-->

<!--1. Advanced Change Detection-->

<!--2. Server side rendering / Universal apps-->

<!--3. 3rd party integration (chart library)-->

<!--4. Cool Down: Scope of Framework-->
<!-- - Complete Framework-->
<!-- - Large API Surface-->
<!-- - Template style-->

<!--TODO:-->
<!-- - Abstract-->
<!-- - Repository-->
<!-- - Slides-->
<!-- - Demos-->

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

                <section>
                    <h2>Angular 2 and React learning from each other</h2>
                    <!--<p>-->
                        <!--<small><a href="http://zeigermann.eu">Oliver Zeigermann</a> / <a href="http://twitter.com/djcordhose">@DJCordhose</a>-->
                        <!--</small>-->
                    <!--</p>-->

                    <p>Slides:
                        <a href="https://djcordhose.github.io/angular2-react/">
                            https://djcordhose.github.io/angular2-react/
                        </a></p>
                </section>

                <section>
                    <a href="https://twitter.com/johnjcz/status/777942732102701056" target="_blank">
                    <img src="twitter-react-angular2.png" style="width: 900px;">
                        </a>
                    <p><small>
                        <a href="https://twitter.com/johnjcz/status/777942732102701056" target="_blank">
                        https://twitter.com/johnjcz/status/777942732102701056
                    </a>
                    </small></p>
                </section>


                <section>
                    <h2>http://stateofjs.com</h2>
                    <p>Recently published survey on the state of JavaScript</p>
                </section>

                <section>
                    <a href="http://stateofjs.com/2016/frontend/" target="_blank">
                        <img src="stateofjs-frameworks-tldr.png">
                    </a>
                    <p><small><a href="http://stateofjs.com/2016/frontend/" target="_blank">
                        http://stateofjs.com/2016/frontend/
                    </a></small></p>
                </section>

                <section>
                    <a href="http://stateofjs.com/2016/frontend/" target="_blank">
                        <img src="stateofjs-frameworks-overview.png" height="600px">
                    </a>
                    <p><small><a href="http://stateofjs.com/2016/frontend/" target="_blank">
                        http://stateofjs.com/2016/frontend/
                    </a></small></p>
                </section>

                <!--<section>-->
                    <!--<a href="http://stateofjs.com/2016/frontend/" target="_blank">-->
                        <!--<img src="stateofjs-frameworks-overview-numbers.png" height="600px">-->
                    <!--</a>-->
                    <!--<p><small><a href="http://stateofjs.com/2016/frontend/" target="_blank">-->
                        <!--http://stateofjs.com/2016/frontend/-->
                    <!--</a></small></p>-->
                <!--</section>-->

                <section>
                    <h1>Advanced Change Detection</h1>
                </section>

                <section>
                    <h2>Overview</h2>
                    <p><a href="http://teropa.info/blog/2015/03/02/change-and-its-detection-in-javascript-frameworks.html" target="_blank">
                        Change And Its Detection In JavaScript Frameworks
                    </a></p>
                </section>

                <section>
                    <h2>Example: SVG Boxes</h2>
                    <a href="/Users/olli/Development/angular2-react/code/vanilla" target="_blank">
                        <img src="screenshot_svg.png" height="500px">
                    </a>
                    <p>Move a single Box using D'n'D</p>
                </section>

                <section>
                    <h2>A really mean example</h2>
                    <p>Super fast using no framework at all (as only one box at a time needs update)</p>
                    <p>Overhead introduced by framework makes application slow</p>
                    <p>Challenge is to execute as little code as possible when updating a single model of a box</p>
                    <p>Model naturally is a flat list of boxes</p>
                    <p>No natural hierarchy - which would make change detection easier</p>
                </section>

                <section>
                    <h2>React</h2>
                </section>

                <section>
                    <h2>Unoptimized Version</h2>
                    <a href="code/react/0-start/public" target="_blank">
                        <img src="screenshot_svg.png" height="500px">
                    </a>
                    <p>Even for 2000 boxes no fun, really laggy</p>
                </section>

                <section>
                    <img src="yuss.jpg">
                </section>

                <section>
                    <h2>Change Detection on Level of Virtual DOM</h2>
                    <p>With every move of the mouse the full application (all boxes) are re-rendered</p>
                    <p>Not as a DOM, but in a light weight structure called Virtual DOM</p>
                    <p>Then only the difference of old and new Virtual DOM effects the real DOM</p>
                </section>

                <section>
                    <h2>Change Detection on Level of Model</h2>
                    <p><em>shouldComponentUpdate</em> is a lifecycle method on a component that can shortcut this procedure</p>
                    <p>it can check old model against new model</p>
                    <p>immutable data structures
                        (<a href="https://facebook.github.io/immutable-js/" target="_blank">immutable.js</a>) can speed up the check</p>
                </section>

                <section>
                    <h2>Optimized Version</h2>
                    <a href="code/react/1-advanced-change-detection/public" target="_blank">
                        <img src="screenshot_svg.png" height="500px">
                    </a>
                    <p>Just a tiny bit faster, as rendering a single box is fast anyway</p>
                </section>

                <section>
                    <h3>The Box Component</h3>
                <pre><code data-trim contenteditable class="line-numbers" data-leftpad>
class Box extends React.Component {
  shouldComponentUpdate(nextProps) {
    // simple check: every change to a box creates a new object
    const changed = this.props.box !== nextProps.box;
    return changed;
  }

  render() {
    const {box, selected} = this.props;
    if (selected) {
      return &lt;rect data-id={box.id} width="10" height="10" x={box.x} y={box.y}
                   stroke="red" fill="opaque" strokeWidth="2"/>;
    } else {
      return &lt;rect data-id={box.id} width="10" height="10" x={box.x} y={box.y}
                   stroke="black" fill="transparent" strokeWidth="1"/>;
    }
  }
}
               </code></pre>
                </section>

                <section>
                    <h2>Final Solution</h2>
                    <p>We introduce an artificially segmented model</p>
                    <p>each segment contains a number of boxes</p>
                    <p>only the segment that contains the moving box needs to update</p>
                    <p>makes change detection on model level much more efficient</p>
                    <p>Code gets much more complicated, only do this if you really need to</p>
                </section>


                <section>
                    <h3>Optimized by Segmented Model</h3>
                    <a href="code/react/1b-advanced-change-detection-segments/public" target="_blank">
                        <img src="screenshot_svg.png" height="500px">
                    </a>
                    <p>Really smooth for any amount of boxes</p>
                </section>


                <section>
                    <h1>Server Side Rendering / Universal Apps</h1>
                </section>

                <section>
                    <h2>Single Page Application</h2>
                    <a href="code/react/1b-advanced-change-detection-segments/public"
                       target="_blank">
                        <img src="screenshot_svg_spa.png" height="450px">
                    </a>
                    <p>First Page-Impression flickers with a standard SPA</p>
                </section>

                <section>
                    <h3>Issues of Single-Page Applications</h3>
                    <ul>
                        <li>SEO
                        <li>First-Page-Impressions
                        <li>Preview, e.g.
                            <ul>
                                <li>of Search Results or
                                <li>when sharing Links on Social Media
                            </ul>
                        </li>
                        <!--<li>Progressive Enhancement-->
                    </ul>
                </section>

                        <section>
            <h3>Universal Rendering</h3>
            <ul class="fragment">
                <li>First-Page-Impressions rendered statically on server side for a selection of pages
                <li>Probably includes index page
                <li>Links being rendered into page as ordinary HTML-Links
                <li>Pages being linked to can also be rendered statically on server
                <li>application code is shared between Server and Client</li>
            </ul>
        </section>

        <section>
            <h3>Server Side Code</h3>
<pre><code data-trim contenteditable class="javascript line-numbers">
  const boxes = createBoxes(2000);
  const html =
  renderToString(
      &lt;App boxes={boxes}/>
  );
  reply(renderFullPage(html, boxes));
</code></pre>
        </section>

            <section>
                    <h3>How to transfer state from Server to Client?</h3>
<pre><code data-trim contenteditable class="html line-numbers">
&lt!-- server -->
function renderFullPage(html, initialData) {
  return `
&lt;html>
  &lt;body>
    &lt;div id="mount">${html}&lt;/div>
    &lt;/body>

  &lt;script>
    window.__INITIAL_STATE__ = ${JSON.stringify(initialData)};
  &lt;/script>
&lt;/html>
`;
}</code></pre>
<pre><code data-trim contenteditable class="javascript line-numbers" data-leftpad>
const boxes = window.__INITIAL_STATE__;
ReactDOM.render(&lt;App boxes={boxes}/>, document.getElementById('mount'));
</code></pre>
                </section>
            <section>
                <h3>How to suppress ein Re-Rendering on Client?</h3>
                <div>
                    <img src="universal-checksum.png">
                </div>
                <p>When Checksums on Server and Client side match, React does not re-render</p>
            </section>

                <section>
                    <h2>Universal Rendering</h2>
                    <a href="http://localhost:3000" target="_blank">
                        <img src="screenshot_svg_universal.png" height="450px">
                    </a>
                    <p>Rendering on the server is not very fast either, but at least no flickering</p>
                </section>

                <section>
                    <h3>Universal Rendering for the Win</h3>
                    <ul>
                        <li><em>SEO</em>: Solved, as page fully rendering without JavaScript
                        <li ><em>First-Page-Impressions</em>: Fast, as rendered on Server Side and JavaScript can be loaded later, no re-rendering
                        <li ><em>Preview</em>: Solved, page fully rendered on Server Side
                        <li ><em>Progressive Enhancement</em>: As Links are ordinary HTML Links, page can at least deliver all contents
                    </ul>
                </section>

                <section>
                    <a target="_blank"
                       href="https://twitter.com/mxstbr/status/776812185276284928">
                        <img src="twitter_universal.png">
                    </a>
                </section>

                <section>
                    <h1>3rd party integration</h1>
                </section>

                <section>
                    <h2>3rd Party libraries?</h2>
                    <p>There are a lot of 3rd party libraries around</p>
                    <p>They are typically not written in the framework of your choice</p>
                    <p>Examples</p>
                    <p><em>jQuery</em> and <em>jQuery</em> plugins like <em>Bootstrap</em></p>
                    <p><em>d3</em> for interactive SVGs and more abstract charting libs like <em>nvd3</em></p>
                </section>

                <section>
                    <h3>Our example: Distribution of boxes</h3>
                    <a href="code/react/3-third-party-integration/public" target="_blank">
                        <img src="screenshot_3rd_party.png">
                    </a>
                    <p><em>nvd3</em> pie chart using <em>d3</em></p>
                </section>

                <section>
                    <h3>Challenges</h3>
                    <ol>
                        <li>How to get access to the DOM node of the component?
                        <li>How do we tell the framework that rendering is on us?
                        <li>When exactly do we take over rendering?
                        <li>How to we still get updates?
                    </ol>
                </section>
                <section>
                    <h3>React Chart Component</h3>
                    <pre><code data-trim contenteditable class="line-numbers" data-leftpad>
class Chart extends React.Component {
    render() {
        // (1) we render an empty svg and remember the reference to the DOM node
        return &lt;svg ref={c => this._chart = c}>&lt;/svg>
    }
    shouldComponentUpdate() {
        // (2) once rendered react never renders again
        return false;
    }
    componentDidMount() {
        // (3) once rendered by react we create the nvd3 chart
        const data = calculateDistributionData(this.props.positions);
        createNvd3Chart(this._chart, data);
    }
    componentWillReceiveProps(nextProps) {
        // (4) we still get updates of properties making it reactive
        const data = calculateDistributionData(nextProps.positions);
        updateNvd3Chart(this._chart, data);
    }
}
               </code></pre>
                </section>
                <section>
                    <h3>Angular Chart Component</h3>
                    <pre><code data-trim contenteditable class="line-numbers" data-leftpad>
@Component({
  template: `<svg></svg>`,
  // (2) position array will never change, so this effectively disables re-draw
  changeDetection: ChangeDetectionStrategy.OnPush
})
class Chart implements AfterViewInit, DoCheck {
  private _chart: HTMLElement;
  private _differ: IterableDiffer;
  @Input() positions: any[];

  // (1) getting access to the native DOM node
  constructor(@Inject(ElementRef) elementRef: ElementRef, differs: IterableDiffers) {
    this._chart = elementRef.nativeElement;
    this._differ = differs.find(this.positions).create(null);
  }

  // (3) now we are in charge of rendering
  ngAfterViewInit() {
    createNvd3Chart(this._chart, this.positions);
  }

  // (4) ngOnChanges won't, but we can handle it low level
  ngDoCheck() {
    const changes = this._differ.diff(this.positions);
    if (changes) {
      updateNvd3Chart(this._chart, this.positions);
    }
  }
}
               </code></pre>
                </section>

                <section>
                    <h3>How does the 3rd party code look like?</h3>
                    <pre><code data-trim contenteditable class="line-numbers" data-leftpad>
import d3 from 'd3';
import nv from 'nvd3';

function createNvd3Chart(svg, data) {
    nv.addGraph(() => {
        const chart = nv.models.pieChart()
            .x(function(d) { return d.label })
            .y(function(d) { return d.value })
            .showLabels(true);

        d3.select(svg)
            .datum(data)
            .transition().duration(350)
            .call(chart);
        return chart;
    });
}
               </code></pre>
                </section>


                <section>
                    <h2>Scope Of Framework</h2>
                    <ul>
                        <li>React
                            <ul>
                                <li>just the rendering lib
                                <li>small API surface
                                <li>often needs additional libraries (e.g. type checking, routing)</li>
                            </ul>
                        </li>
                        <li>Angular
                            <ul>
                                <li>complete framework (batteries included)</li>
                                <li>large API Surface</li>
                                <li>helps you with a lot of decisions</li>
                            </ul>
                        </li>
                    </ul>
                </section>

                <!--<section>-->
                    <!--<h1>templating style</h1>-->
                <!--</section>-->

                <!--<section>-->
                    <!--<h1>data flow patterns</h1>-->
                <!--</section>-->

                <!--<section>-->
                    <!--<h1>designated type system</h1>-->
                <!--</section>-->

                <!--<section>-->
                    <!--<h1>routing</h1>-->
                <!--</section>-->

            <section>
            <h1>Thank you!</h1>

            <!--<h2>Questions / Discussion</h2>-->
            <!--<p>-->
                <!--<a href="http://zeigermann.eu">Oliver Zeigermann</a> / <a href="http://twitter.com/djcordhose">@DJCordhose</a>-->

            <!--</p>-->
            <!--<p><a href="http://bit.ly/spa-frameworks">-->
                <!--http://bit.ly/spa-frameworks-->
            <!--</a></p>-->

        </section>

                </div>

		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.js"></script>
        <script src="lib/jquery-2.2.4.js"></script>
    <script>
        $('section').attr('data-background-image', "backgrounds/dark-sky.jpg");
    </script>
    <script>
        // only presentation version has fragments
        if (window.location.hostname.indexOf('localhost') === -1) {
            $('.fragment').removeClass('fragment');
        }
    </script>


    <script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
					{ src: 'reveal.js/plugin/notes/notes.js', async: true },
                    { src: 'lib/js/line-numbers.js'}
                ]
			});

		</script>

	</body>
</html>
